@model EasyGames.Models.StockItem

@* Card layout for displaying a single product *@
<div class="card h-100 shadow-sm">
    
    <!-- Show product image if available -->
    @if (!string.IsNullOrWhiteSpace(Model.ImageUrl))
    {
        <img src="@Model.ImageUrl" alt="@Model.Title"
             class="card-img-top" style="height:180px;object-fit:cover;" />
    }
    
    <div class="card-body d-flex flex-column">

        <h6 class="card-title mb-1">@Model.Title</h6>

        <div class="small text-muted mb-2">@Model.Category?.Name</div>

        <div class="mb-2 fw-semibold">@Model.Price.ToString("C")</div>

        <!-- Stock info and Add-to-Cart button -->
        <div class="mt-auto d-flex justify-content-between align-items-center">

            <!-- Badge changes color if stock is low -->
            <span class="badge @(Model.Quantity <= 5 ? "text-bg-danger" : "text-bg-secondary")">
                In stock: @Model.Quantity
            </span>
            
            <!-- If logged in as "User", allow adding to cart -->
            @if (User?.IsInRole("User") == true)
            {
                <form asp-controller="Cart" asp-action="Add" method="post" class="m-0 d-flex gap-2">
                    <input type="hidden" name="id" value="@Model.Id" />
                    <input class="form-control form-control-sm" type="number" name="qty" value="1" min="1" style="width:80px" />
                    <button class="btn btn-primary btn-sm">Add</button>
                </form>
            }
            else
            {
                <!-- If not logged in, redirect user to login page -->
                <a asp-controller="Account" asp-action="Login" class="btn btn-primary btn-sm">Login to buy</a>
            }
        </div>
    </div>
</div>
